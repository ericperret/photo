<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Correction de Perspective</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #333;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            padding: 20px;
            background-color: #f8f8f8;
            border-radius: 8px;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
        }
        
        label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #555;
        }
        
        input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }
        
        .value-display {
            text-align: center;
            color: #666;
            font-size: 14px;
        }
        
        .image-container {
            position: relative;
            display: inline-block;
            margin: 20px auto;
            text-align: center;
            width: 100%;
        }
        
        #canvas-wrapper {
            position: relative;
            display: inline-block;
            border: 2px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
        }
        
        canvas {
            display: block;
            max-width: 100%;
            height: auto;
        }
        
        .buttons {
            text-align: center;
            margin-top: 20px;
        }
        
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 0 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        button:active {
            transform: scale(0.98);
        }
        
        #resetBtn {
            background-color: #f44336;
        }
        
        #resetBtn:hover {
            background-color: #da190b;
        }
        
        #fileInput {
            display: none;
        }
        
        .info {
            background-color: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin-top: 20px;
            border-radius: 4px;
        }
        
        .info h3 {
            margin-top: 0;
            color: #1976D2;
        }
        
        .info p {
            margin: 5px 0;
            color: #555;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Correction de Perspective d'Image</h1>
        
        <div class="controls">
            <div class="control-group">
                <label for="rotateX">Rotation X (Inclinaison verticale)</label>
                <input type="range" id="rotateX" min="-60" max="60" value="0" step="1">
                <span class="value-display" id="rotateXValue">0°</span>
            </div>
            
            <div class="control-group">
                <label for="rotateY">Rotation Y (Inclinaison horizontale)</label>
                <input type="range" id="rotateY" min="-60" max="60" value="0" step="1">
                <span class="value-display" id="rotateYValue">0°</span>
            </div>
            
            <div class="control-group">
                <label for="rotateZ">Rotation Z (Rotation dans le plan)</label>
                <input type="range" id="rotateZ" min="-180" max="180" value="0" step="1">
                <span class="value-display" id="rotateZValue">0°</span>
            </div>
            
            <div class="control-group">
                <label for="perspective">Perspective</label>
                <input type="range" id="perspective" min="200" max="2000" value="1000" step="50">
                <span class="value-display" id="perspectiveValue">1000px</span>
            </div>
            
            <div class="control-group">
                <label for="scale">Échelle</label>
                <input type="range" id="scale" min="0.5" max="2" value="1" step="0.1">
                <span class="value-display" id="scaleValue">1.0x</span>
            </div>
            
            <div class="control-group">
                <label for="skewX">Inclinaison X</label>
                <input type="range" id="skewX" min="-30" max="30" value="0" step="1">
                <span class="value-display" id="skewXValue">0°</span>
            </div>
            
            <div class="control-group">
                <label for="skewY">Inclinaison Y</label>
                <input type="range" id="skewY" min="-30" max="30" value="0" step="1">
                <span class="value-display" id="skewYValue">0°</span>
            </div>

            <!-- Nouveau slider inversion -->
            <div class="control-group">
                <label for="invert">Inversion (négatif)</label>
                <input type="range" id="invert" min="0" max="100" value="0" step="1">
                <span class="value-display" id="invertValue">0%</span>
            </div>

            <!-- Nouveau slider contraste -->
            <div class="control-group">
                <label for="contrast">Contraste</label>
                <input type="range" id="contrast" min="50" max="200" value="100" step="1">
                <span class="value-display" id="contrastValue">100%</span>
            </div>
        </div>
        
        <div class="buttons">
            <input type="file" id="fileInput" accept="image/*">
            <button onclick="document.getElementById('fileInput').click()">Charger une image</button>
            <button id="resetBtn" onclick="resetTransform()">Réinitialiser</button>
            <button onclick="saveImage()">Sauvegarder l'image</button>
        </div>
        
        <div class="image-container">
            <div id="canvas-wrapper">
                <canvas id="imageCanvas"></canvas>
            </div>
        </div>
        
        <div class="info">
            <h3>Guide d'utilisation :</h3>
            <p><strong>1.</strong> Cliquez sur "Charger une image" pour sélectionner votre photo</p>
            <p><strong>2.</strong> Utilisez les curseurs pour ajuster la perspective et les filtres</p>
            <p>&nbsp;&nbsp;&nbsp;&nbsp;• <strong>Rotation X/Y</strong> : Pour corriger l'inclinaison</p>
            <p>&nbsp;&nbsp;&nbsp;&nbsp;• <strong>Inversion</strong> : Pour passer en négatif progressif</p>
            <p>&nbsp;&nbsp;&nbsp;&nbsp;• <strong>Contraste</strong> : Pour renforcer ou réduire le contraste</p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('imageCanvas');
        const ctx = canvas.getContext('2d');
        let img = new Image();
        let originalImage = null;
        
        let transform = {
            rotateX: 0,
            rotateY: 0,
            rotateZ: 0,
            perspective: 1000,
            scale: 1,
            skewX: 0,
            skewY: 0,
            invert: 0,
            contrast: 100
        };
        
        img.onload = function() {
            originalImage = img;
            canvas.width = img.width;
            canvas.height = img.height;
            drawImage();
        };
        
        function createDefaultImage() {
            canvas.width = 600;
            canvas.height = 400;
            ctx.fillStyle = '#f0f0f0';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            const squareSize = 50;
            for (let i = 0; i < canvas.height / squareSize; i++) {
                for (let j = 0; j < canvas.width / squareSize; j++) {
                    if ((i + j) % 2 === 0) {
                        ctx.fillStyle = '#333';
                        ctx.fillRect(j * squareSize, i * squareSize, squareSize, squareSize);
                    }
                }
            }
            
            ctx.fillStyle = '#4CAF50';
            ctx.font = '48px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('PERSPECTIVE', canvas.width / 2, canvas.height / 2);
            
            canvas.toBlob(function(blob) {
                img.src = URL.createObjectURL(blob);
            });
        }
        
        createDefaultImage();
        
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    img = new Image();
                    img.onload = function() {
                        originalImage = img;
                        canvas.width = img.width;
                        canvas.height = img.height;
                        drawImage();
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });
        
        function drawImage() {
            if (!originalImage) return;
            ctx.save();
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const wrapper = document.getElementById('canvas-wrapper');
            wrapper.style.perspective = transform.perspective + 'px';
            
            canvas.style.transform = `
                rotateX(${transform.rotateX}deg)
                rotateY(${transform.rotateY}deg)
                rotateZ(${transform.rotateZ}deg)
                scale(${transform.scale})
                skewX(${transform.skewX}deg)
                skewY(${transform.skewY}deg)
            `;
            
            canvas.style.filter = `
                invert(${transform.invert}%)
                contrast(${transform.contrast}%)
            `;
            
            ctx.drawImage(originalImage, 0, 0);
            ctx.restore();
        }
        
        document.getElementById('rotateX').addEventListener('input', function(e) {
            transform.rotateX = e.target.value;
            document.getElementById('rotateXValue').textContent = e.target.value + '°';
            drawImage();
        });
        
        document.getElementById('rotateY').addEventListener('input', function(e) {
            transform.rotateY = e.target.value;
            document.getElementById('rotateYValue').textContent = e.target.value + '°';
            drawImage();
        });
        
        document.getElementById('rotateZ').addEventListener('input', function(e) {
            transform.rotateZ = e.target.value;
            document.getElementById('rotateZValue').textContent = e.target.value + '°';
            drawImage();
        });
        
        document.getElementById('perspective').addEventListener('input', function(e) {
            transform.perspective = e.target.value;
            document.getElementById('perspectiveValue').textContent = e.target.value + 'px';
            drawImage();
        });
        
        document.getElementById('scale').addEventListener('input', function(e) {
            transform.scale = e.target.value;
            document.getElementById('scaleValue').textContent = e.target.value + 'x';
            drawImage();
        });
        
        document.getElementById('skewX').addEventListener('input', function(e) {
            transform.skewX = e.target.value;
            document.getElementById('skewXValue').textContent = e.target.value + '°';
            drawImage();
        });
        
        document.getElementById('skewY').addEventListener('input', function(e) {
            transform.skewY = e.target.value;
            document.getElementById('skewYValue').textContent = e.target.value + '°';
            drawImage();
        });

        document.getElementById('invert').addEventListener('input', function(e) {
            transform.invert = e.target.value;
            document.getElementById('invertValue').textContent = e.target.value + '%';
            drawImage();
        });

        document.getElementById('contrast').addEventListener('input', function(e) {
            transform.contrast = e.target.value;
            document.getElementById('contrastValue').textContent = e.target.value + '%';
            drawImage();
        });
        
        function resetTransform() {
            transform = {
                rotateX: 0,
                rotateY: 0,
                rotateZ: 0,
                perspective: 1000,
                scale: 1,
                skewX: 0,
                skewY: 0,
                invert: 0,
                contrast: 100
            };
            
            document.getElementById('rotateX').value = 0;
            document.getElementById('rotateY').value = 0;
            document.getElementById('rotateZ').value = 0;
            document.getElementById('perspective').value = 1000;
            document.getElementById('scale').value = 1;
            document.getElementById('skewX').value = 0;
            document.getElementById('skewY').value = 0;
            document.getElementById('invert').value = 0;
            document.getElementById('contrast').value = 100;
            
            document.getElementById('rotateXValue').textContent = '0°';
            document.getElementById('rotateYValue').textContent = '0°';
            document.getElementById('rotateZValue').textContent = '0°';
            document.getElementById('perspectiveValue').textContent = '1000px';
            document.getElementById('scaleValue').textContent = '1.0x';
            document.getElementById('skewXValue').textContent = '0°';
            document.getElementById('skewYValue').textContent = '0°';
            document.getElementById('invertValue').textContent = '0%';
            document.getElementById('contrastValue').textContent = '100%';
            
            drawImage();
        }
        
        function saveImage() {
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            tempCanvas.width = canvas.width;
            tempCanvas.height = canvas.height;
            tempCtx.drawImage(canvas, 0, 0);
            tempCanvas.toBlob(function(blob) {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'image_corrigee.png';
                a.click();
                URL.revokeObjectURL(url);
            });
        }
    </script>
</body>
</html>